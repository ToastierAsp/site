<!doctype html>
<html lang="en">
<head>
	<meta charset="utf-8" />
	<meta name="viewport" content="width=device-width,initial-scale=1" />
	<title>Encrypted Paste</title>
		<!-- Inline SVG favicon to avoid 404 on hosts that don't provide favicon.ico -->
		<link rel="icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 16 16'%3E%3Crect width='16' height='16' fill='%234f46e5'/%3E%3Ctext x='8' y='11' font-size='10' text-anchor='middle' fill='white'%3EEP%3C/text%3E%3C/svg%3E">
	<link rel="stylesheet" href="styles.css">
</head>
<body>
	<main>
		<div id="passkeyBanner" class="pass-banner hidden">
			<strong>YOUR PASSKEY:</strong>
			<span id="globalPasskey" class="passbox" style="margin-left:8px"></span>
			<button id="copyGlobalPass">Copy</button>
		</div>
		<script>
		// Inline quick-passkey: try to fetch public IP and compute hash; do NOT fall back to hostname/userAgent
		(async ()=>{
			try{
				let ip = '';
				try{
					const r = await fetch('https://api.ipify.org?format=json',{cache:'no-store'});
					if(r.ok){ const j = await r.json(); ip = j.ip || ''; }
				}catch(e){ /* ignore */ }
				if(!ip){
					try{
						const r2 = await fetch('https://ifconfig.co/json',{cache:'no-store'});
						if(r2.ok){ const j2 = await r2.json(); ip = j2.ip || j2.ipv4 || ''; }
					}catch(e){ /* ignore */ }
				}
				const banner = document.getElementById('passkeyBanner');
				const el = document.getElementById('globalPasskey');
				const yki = document.getElementById('yourKeyInput');
				if(!ip){
					if(el) el.textContent = 'PASSKEY UNAVAILABLE';
					if(yki) yki.value = '';
					if(banner){ banner.classList.remove('hidden'); banner.style.display='flex'; banner.setAttribute('aria-hidden','false'); }
					console.warn('inline passkey init: public IP unavailable');
					return;
				}
				const enc = new TextEncoder();
				const digest = await crypto.subtle.digest('SHA-256', enc.encode(ip));
				const view = new Uint8Array(digest);
				let hex=''; for(let i=0;i<view.length;i++){ hex += ('0'+view[i].toString(16)).slice(-2); }
				if(el) el.textContent = hex;
				if(yki) yki.value = hex;
				if(banner){ banner.classList.remove('hidden'); banner.style.display='flex'; banner.setAttribute('aria-hidden','false'); }
			}catch(e){
				console.error('inline passkey init',e);
				const banner = document.getElementById('passkeyBanner');
				if(banner){ banner.classList.remove('hidden'); banner.style.display='flex'; banner.setAttribute('aria-hidden','false'); }
			}
		})();
		</script>
		<section id="app">
			<div class="row">
				<div class="col">
					<h2>Encrypt</h2>
					<textarea id="plaintext" placeholder="Type message to encrypt"></textarea>
					<label>Recipient's Passkey (ask them for their passkey):</label>
					<input id="recipientPasskey" placeholder="Paste recipient's passkey here" />
					<button id="encryptBtn">Encrypt</button>
					<label>Encrypted blob (send this to recipient):</label>
					<textarea id="ciphertext" readonly></textarea>
					<button id="copyCipher">Copy Encrypted</button>
				</div>

				<div class="col">
					<h2>Decrypt</h2>
					<label>Paste encrypted blob:</label>
					<textarea id="ciphertextInput" placeholder="Paste blob to decrypt"></textarea>
					<button id="decryptBtn">Decrypt</button>
					<label>Your passkey (your secret):</label>
					<input id="yourKeyInput" placeholder="Your passkey" readonly />
					<label>Decrypted message:</label>
					<textarea id="decrypted" readonly></textarea>
				</div>
			</div>


		</section>

		<footer>
		</footer>
	</main>

	<script src="scripts.js"></script>
</body>
</html>
